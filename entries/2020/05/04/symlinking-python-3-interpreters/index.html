<!DOCTYPE html>
<html lang="en">
<head>
    <title>TIL - Symlinking Python (3)&nbsp;Interpreters</title>

  <link rel="stylesheet" href="https://til.grayvines.com/theme/css/main.css" />
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css" rel="stylesheet" type="text/css">

  <meta charset="utf-8" />
  <link href="https://til.grayvines.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="TIL Full Atom Feed" />
  <link href="https://til.grayvines.com/feeds/python.atom.xml" type="application/atom+xml" rel="alternate" title="TIL Categories Atom Feed" />






</head>

<body>

  <header id="site-header">
    <div class="container">
      <a href="https://til.grayvines.com/"><h1 class="blog-title">TIL</h1></a>
      <p class="blog-description">Today I Learned</p>
    </div>

<nav id="menu"><ul>


      <li><a href="https://til.grayvines.com/categories/design/">design</a></li>
      <li><a href="https://til.grayvines.com/categories/food/">food</a></li>
      <li><a href="https://til.grayvines.com/categories/health/">health</a></li>
      <li><a href="https://til.grayvines.com/categories/history/">history</a></li>
      <li><a href="https://til.grayvines.com/categories/language/">language</a></li>
      <li><a href="https://til.grayvines.com/categories/math/">math</a></li>
      <li><a href="https://til.grayvines.com/categories/misc/">misc</a></li>
      <li><a href="https://til.grayvines.com/categories/music/">music</a></li>
      <li><a href="https://til.grayvines.com/categories/physics/">physics</a></li>
      <li><a href="https://til.grayvines.com/categories/programming/">programming</a></li>
      <li class="active"><a href="https://til.grayvines.com/categories/python/">python</a></li>
      <li><a href="https://til.grayvines.com/categories/sports/">sports</a></li>
      <li><a href="https://til.grayvines.com/categories/theorems/">theorems</a></li>
      <li><a href="https://til.grayvines.com/categories/travel/">travel</a></li>
</ul></nav><!-- /#menu -->  </header><!-- /#site-header -->


<main class="content" role="main">
  <div class="container">
    <article class="entry">
      <header class="entry-header">
        <h3 class="p-entry-title">
          <a href="https://til.grayvines.com/entries/2020/05/04/symlinking-python-3-interpreters/" rel="bookmark" title="Permalink to Symlinking Python (3)Â Interpreters">
            Symlinking Python (3)&nbsp;Interpreters
          </a>
        </h3>

        <p class="entry-time">
          <time class="published" datetime="2020-05-04T13:39:06-04:00">
            May 04, 2020
          </time>
        </p>
    
      </header>

      <section class="entry-content">
        <p><a class="reference external" href="https://www.python.org/dev/peps/pep-0405/#id17"><span class="caps">PEP</span> 405</a> introduced
a <tt class="docutils literal">pyvenv.cfg</tt> file, useful for creating lightweight virtual
environments without the hacks done by <tt class="docutils literal">virtualenv</tt> historically.
Doing so is much, much faster as well, since now creation of a virtual
environment is essentially just creating 2 files (one file and a&nbsp;symlink).</p>
<p>It also though changed the behavior of symlinking a Python interpreter binary.
Specifically, if you&nbsp;do:</p>
<pre class="literal-block">
ln -s /a/python3 /some/other/directory/
</pre>
<p>then <tt class="docutils literal">/some/other/directory/python</tt> is seen as an entirely different virtual
environment. It will have entirely different <tt class="docutils literal"><span class="pre">site-packages</span></tt> (i.e. will not
see packages installed to the original&nbsp;interpreter).</p>
<p>Full&nbsp;reproducer:</p>
<pre class="literal-block">
$ python3.8 -m venv venv &amp;&amp; \
  venv/bin/python -m pip install --quiet attrs &amp;&amp; \
  echo 'in-place' &amp;&amp; \
  venv/bin/python -c 'import attr' &amp;&amp; \
  echo 'succeeded' &amp;&amp; \
  ln -s venv/bin/python ./symlink &amp;&amp; \
  echo 'symlink:' &amp;&amp; \
  ./symlink -c 'import attr'; rm -rf venv symlink
</pre>
<p>It&#8217;s unclear to me why this behavior is desireable &#8212; to me, it seems a
lot more reasonable for the presence of a <tt class="docutils literal">pyvenv.cfg</tt> file to
trigger the virtual environment behavior, not merely creating a symlink.
I.e., the behavior I would have expected&nbsp;is:</p>
<blockquote>
<ul class="simple">
<li>on startup of a Python interpreter, look for a <tt class="docutils literal">pyvenv.cfg</tt> next
to the absolute path of <tt class="docutils literal">sys.argv[0]</tt></li>
<li>if you find it, this is a virtual environment, read and process&nbsp;it</li>
<li>otherwise, if <tt class="docutils literal">sys.argv[0]</tt> is a symlink, <tt class="docutils literal">readlink</tt> it and re-check
for a <tt class="docutils literal">pyvenv.cfg</tt> (following the behavior above) or otherwise
terminating once a non-symlink is reached. But <tt class="docutils literal">sys.argv[0]</tt> alone
being a symlink does not change the isolation or behavior of the linked&nbsp;interpreter.</li>
</ul>
</blockquote>
<p>I&#8217;m not sure I have enough energy to investigate whether the above was
considered and/or has some critical issue I don&#8217;t see, but the current
behavior is quite surprising (something I only notice now given that
<tt class="docutils literal">virtualenv</tt> just adopted it as of <tt class="docutils literal"><span class="pre">virtualenv&gt;=20</span></tt>).</p>
<p>If you know why the above was chosen, or want to argue it&#8217;s better, let
me know&nbsp;:)</p>

      </section><!-- /.entry-content -->

      <hr>

      <footer class="entry-footer">
        <section class="f-1">
          <section class="f-entry-time">
              <time class="published" datetime="2020-05-04T13:39:06-04:00">
                May 04, 2020
              </time>
          </section>
          <p class="f-entry-time">
            <time class="modified" datetime="2020-05-30T15:21:31-04:00">
              Modified on May 30, 2020
            </time>
          </p>
        </section>

        <section class="f-2">
          <div class="category">
              Category: <a href="https://til.grayvines.com/categories/python/">python</a>
          </div>
        </section>
      </footer><!-- /.entry-info -->
    </article>
  </div>
</main>

<footer id="site-footer" class="body">
  <div class="container">
    <a href="https://www.instagram.com/julianberman/" title="Instagram" target="_blank">
      <span class="tooltip"><i class="fab fa-instagram"></i></span>
    </a>
    <a href="https://www.twitter.com/JulianWasTaken" title="Twitter" target="_blank">
      <span class="tooltip"><i class="fab fa-twitter"></i></span>
    </a>
    <a href="https://www.github.com/Julian" title="GitHub" target="_blank">
      <span class="tooltip"><i class="fab fa-github"></i></span>
    </a>


    <section>&copy; <a href="https://github.com/Julian">Julian Berman</a> 2020</section>
    <section>Theme modified from <a href="http://www.jrdnbwmn.com">Detox by Jordan Bowman</a>. Generated with <a href="https://getpelican.com">Pelican</a>.</section>
  </div>
</footer><!-- /#contentinfo -->
</body>
</html>